# Особенности, связанные с Vue

*Данные правила относятся только к компонентам в `./client/components`*

## Пара слов о линтинге

По причине того, что `eslint-plugin-vue` из коробки не определяет `.js` как файлы Vue, перед `export default` с объектом компонента **всегда** необходимо вставлять специальный комментарий `@vue/component`:

```js
import GaIcon from '~/components/atoms/icon';

// @vue/component
export default {
    name: 'ga-button',

    components: {
        GaIcon
    },

    // ...
}
```

## Файловая структура компонента

Все компоненты, даже если какой-то из них состоит из одного файла `.vue`, лежат папках. Имя папки должно быть без вендорных префиксов и в `kebab-case`. Например:

`button` / `link` / `geolocation-modal` – хорошо  
`ga-button` / `ogg-link` / `my-modal` – плохо


### Простой компонент

Обязательным файлом является только index.vue и он **никогда не  должен быть SFC**.

```bash
.
+-- _name.scss      # SASS-файл с CSS именем компонента и
+-- _vars.scss      # его стилевые переменные
|                   # (см. "Особенности, связанные с SASS")
|
+-- index.vue       # шаблон компонента
+-- scripts.js      # логика компонента
+-- styles.scss     # стили компонента
```

### Сложный компонент

Подразумевает наличие элементов, модификаторов или других расширений компонента.

Элементы и модификаторы могут быть **простыми компонентами** или файлами стилей. Если хочется сделать элемент или модификатор сложным компонентом, то это верный признак того, что его следует вынести в отдельный компонент.

Миксины, директивы и прочие инструменты Vue могут использоваться **только** в контексте данного компонента. Если какой-то инструмент может быть использован другими компонентами, то его следует вынести в папку `./client/base`.

```bash
.
+-- elems         # папка с элементами
|   +-- elem      # может быть простым компонентом,
|   |    +-- ...  # сохраняя такую же файловую структуру
|   |
|   +-- elem.scss # а может быть просто файлом со стилями
|
+-- mods          # папка с модификаторами
|   +-- mod       # может быть простым компонентом,
|   |    +-- ...  # сохраняя такую же структуру файлов
|   |
|   +-- mod.scss  # а может быть просто файлом со стилями
|
+-- vue           # папка с инструментами vue
|   +-- mixins
|   +-- directives
|   +-- ...
|
+-- _name.scss
+-- _vars.scss
+-- index.vue
+-- scripts.js
+-- styles.scss
```


## Правила файлов `.vue`

В большинстве случаев вопросы с файлами `.vue` решает линтинг, но основные правила такие:

+ Файл всегда называется `index.vue` и лежит в папке с названием компонента
+ Все компоненты в шаблоне указываются в `kebab-case`
+ Запрещены мутации в слушателях событий (лучше указывать методы-обработчики)
+ Запрещена логика в пропсах (лучше готовить нужные значения заранее, либо выносить логику в методы или computed-свойства)

Спорные моменты обсуждаются на этапе код-ревью.

## Правила файлов `.js`

В большинстве случаев вопросы с файлами `.js` решает линтинг, но основные правила такие:

+ Все внутренние компоненты импортируются с префиксом `Ga` в `PascalCase`
+ Порядок импортов должен быть консистентен и соответствовать такому порядку:  
*(соответственно, в разделах `components`, `mixins` и т.д. порядок и переносы сохраняются)*
```js
// импорты внешних библиотек A-Z
import _ from 'lodash';
import moment from 'moment';

// импорты внешних компонентов A-Z
import VuePortal from 'vue-portal';

// импорты компонентов проекта A-Z
import GaButton from '...';
import GaModal from '...';

// импорты из elems или mods
import GaNavLink from './elems/link';

// импорты методов Vue / Vuex
import { mapGetters, mapState } from 'vuex'

// импорты из ./client/base
import { bemCn, valuable } from '~/client/base/mixins';
```
+ Методы Vuex всегда указываются в самом начале разделов сначала в алфавитном порядке  имен сторов, а затем имен методов:
```js
{
    methods: {
        // [A]pp map[A]ctions
        ...mapActions('app', [
            'listLocations'
        ]),

        // [A]pp map[M]utations
        ...mapMutations('app', [
            'freezeScroll'
        ]),

        // [U]ser map[A]ctions
        ...mapActions('user', [
            'saveData'
        ])
    }
}
```
+ Все обработчики событий начинаются с префикса `on` и включают в себя сущность и действие, например: `onLinkClick`, `onNavExpand`, `onWindowResize`
+ все внутренние свойства работающие с пропсами дублируют название пропса с добавлением постфикса `Internal`, например: `valueInternal`, `idInternal`, `itemsInternal`
+ Порядок разделов компонента должен соответствовать [рекомендациям](https://eslint.vuejs.org/rules/order-in-components.html#options) из `eslint-plugin-vue`, и между разделами всегда должна быть пустая строка.

Спорные моменты обсуждаются на этапе код-ревью.